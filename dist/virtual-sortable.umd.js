(function(B,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],d):(B=typeof globalThis<"u"?globalThis:B||self,d(B.VirtualSortable={},B.Vue))})(this,(function(B,d){"use strict";const kt={modelValue:{},dataKey:{type:String,default:"",required:!0},getItemHeight:{type:Function,required:!0},draggable:{type:String,default:'[role="item"]'},sortable:{type:Boolean,default:!0},handle:{type:[Function,String],default:void 0},group:{type:[Object,String],default:void 0},scroller:{type:[Document,HTMLElement],default:void 0},lockAxis:{type:String,default:""},direction:{type:String,default:"vertical"},debounceTime:{type:Number,default:0},throttleTime:{type:Number,default:0},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollThreshold:{type:Number,default:55},disabled:{type:Boolean,default:!1},fallbackOnBody:{type:Boolean,default:!1},delay:{type:Number,default:0},delayOnTouchOnly:{type:Boolean,default:!1},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:()=>({})},chosenClass:{type:String,default:""},placeholderClass:{type:String,default:""}},Bt={dataKey:{type:[String,Number],default:void 0},sizeKey:{type:String,default:"offsetHeight"}};function Vt(t,e){return d.getCurrentScope()?(d.onScopeDispose(t,e),!0):!1}const zt=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;function Kt(t){return Array.isArray(t)?t:[t]}function $t(t){return d.getCurrentInstance()}function Xt(t,e=!0,n){$t()?d.onMounted(t,n):e?t():d.nextTick(t)}const mt=zt?window:void 0;function Y(t){var e;const n=d.toValue(t);return(e=n?.$el)!==null&&e!==void 0?e:n}function Yt(){const t=d.shallowRef(!1),e=d.getCurrentInstance();return e&&d.onMounted(()=>{t.value=!0},e),t}function Gt(t){const e=Yt();return d.computed(()=>(e.value,!!t()))}function Ut(t,e,n={}){const{window:o=mt,...i}=n;let s;const r=Gt(()=>o&&"ResizeObserver"in o),l=()=>{s&&(s.disconnect(),s=void 0)},c=d.watch(d.computed(()=>{const h=d.toValue(t);return Array.isArray(h)?h.map(a=>Y(a)):[Y(h)]}),h=>{if(l(),r.value&&o){s=new ResizeObserver(e);for(const a of h)a&&s.observe(a,i)}},{immediate:!0,flush:"post"}),u=()=>{l(),c()};return Vt(u),{isSupported:r,stop:u}}function jt(t,e={width:0,height:0},n={}){const{window:o=mt,box:i="content-box"}=n,s=d.computed(()=>{var a;return(a=Y(t))===null||a===void 0||(a=a.namespaceURI)===null||a===void 0?void 0:a.includes("svg")}),r=d.shallowRef(e.width),l=d.shallowRef(e.height),{stop:c}=Ut(t,([a])=>{const w=i==="border-box"?a.borderBoxSize:i==="content-box"?a.contentBoxSize:a.devicePixelContentBoxSize;if(o&&s.value){const S=Y(t);if(S){const v=S.getBoundingClientRect();r.value=v.width,l.value=v.height}}else if(w){const S=Kt(w);r.value=S.reduce((v,{inlineSize:O})=>v+O,0),l.value=S.reduce((v,{blockSize:O})=>v+O,0)}else r.value=a.contentRect.width,l.value=a.contentRect.height},n);Xt(()=>{const a=Y(t);a&&(r.value="offsetWidth"in a?a.offsetWidth:e.width,l.value="offsetHeight"in a?a.offsetHeight:e.height)});const u=d.watch(()=>Y(t),a=>{r.value=a?e.width:0,l.value=a?e.height:0});function h(){c(),u()}return{width:r,height:l,stop:h}}function Ft(t,e){const{containerStyle:n,wrapperProps:o,scrollTo:i,calculateRange:s,currentList:r,containerRef:l}="itemHeight"in e?Qt(e,t):Jt(e,t);return{list:r,scrollTo:i,containerProps:{ref:l,onScroll:()=>{s()},style:n},wrapperProps:o}}function yt(t){const e=d.shallowRef(null),n=jt(e),o=d.ref([]),i=d.shallowRef(t);return{state:d.ref({start:0,end:10}),source:i,currentList:o,size:n,containerRef:e}}function wt(t,e,n){return o=>{if(typeof n=="number")return Math.ceil(o/n);const{start:i=0}=t.value;let s=0,r=0;for(let l=i;l<e.value.length;l++){const c=n(l);if(s+=c,r=l,s>o)break}return r-i}}function bt(t,e){return n=>{if(typeof e=="number")return Math.floor(n/e)+1;let o=0,i=0;for(let s=0;s<t.value.length;s++){const r=e(s);if(o+=r,o>=n){i=s;break}}return i+1}}function St(t,e,n,o,{containerRef:i,state:s,currentList:r,source:l}){return()=>{const c=i.value;if(c){const u=n(t==="vertical"?c.scrollTop:c.scrollLeft),h=o(t==="vertical"?c.clientHeight:c.clientWidth),a=u-e,w=u+h+e;s.value={start:a<0?0:a,end:w>l.value.length?l.value.length:w},r.value=l.value.slice(s.value.start,s.value.end).map((S,v)=>({data:S,index:v+s.value.start}))}}}function vt(t,e){return n=>typeof t=="number"?n*t:e.value.slice(0,n).reduce((o,i,s)=>o+t(s),0)}function xt(t,e,n,o){d.watch([t.width,t.height,()=>d.toValue(e),n],()=>{o()})}function Ct(t,e){return d.computed(()=>typeof t=="number"?e.value.length*t:e.value.reduce((n,o,i)=>n+t(i),0))}const qt={horizontal:"scrollLeft",vertical:"scrollTop"};function Et(t,e,n,o){return i=>{o.value&&(o.value[qt[t]]=n(i),e())}}function Jt(t,e){const n=yt(e),{state:o,source:i,currentList:s,size:r,containerRef:l}=n,c={overflowX:"auto"},{itemWidth:u,overscan:h=5}=t,a=wt(o,i,u),w=St("horizontal",h,bt(i,u),a,n),S=vt(u,i),v=d.computed(()=>S(o.value.start)),O=Ct(u,i);return xt(r,e,l,w),{scrollTo:Et("horizontal",w,S,l),calculateRange:w,wrapperProps:d.computed(()=>({style:{height:"100%",width:`${O.value-v.value}px`,marginLeft:`${v.value}px`,display:"flex"}})),containerStyle:c,currentList:s,containerRef:l}}function Qt(t,e){const n=yt(e),{state:o,source:i,currentList:s,size:r,containerRef:l}=n,c={overflowY:"auto"},{itemHeight:u,overscan:h=5}=t,a=wt(o,i,u),w=St("vertical",h,bt(i,u),a,n),S=vt(u,i),v=d.computed(()=>S(o.value.start)),O=Ct(u,i);return xt(r,e,l,w),{calculateRange:w,scrollTo:Et("vertical",w,S,l),containerStyle:c,wrapperProps:d.computed(()=>({style:{width:"100%",height:`${O.value-v.value}px`,marginTop:`${v.value}px`}})),currentList:s,containerRef:l}}const _t={capture:!1,passive:!1},It=/\s+/g;function J(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}const tt=J(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Dt=J(/Edge/i),lt=J(/safari/i)&&!J(/chrome/i)&&!J(/android/i),Tt=(function(){let t=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return t=!0,!0}}),t})();function T(t,e,n){window.addEventListener?t.addEventListener(e,n,Tt||!tt?_t:!1):window.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function I(t,e,n){window.removeEventListener?t.removeEventListener(e,n,Tt||!tt?_t:!1):window.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function Zt(t,e){if(!t||!t.getBoundingClientRect)return et();let n=t;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){let o=m(n);if(n.clientWidth<n.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll"))return!n.getBoundingClientRect||n===document.body?et():n}while(n=n.parentNode);return et()}function et(){return document.scrollingElement||document.documentElement}function D(t,e,n){if(!t.getBoundingClientRect&&t!==window)return;let o,i,s,r,l,c,u;if(t!==window&&t.parentNode&&t!==et()?(o=t.getBoundingClientRect(),i=o.top,s=o.left,r=o.bottom,l=o.right,c=o.height,u=o.width):(i=0,s=0,r=window.innerHeight,l=window.innerWidth,c=window.innerHeight,u=window.innerWidth),e&&t!==window){n=n||t.parentNode;do if(n&&n.getBoundingClientRect){let h=n.getBoundingClientRect();i-=h.top+parseInt(m(n,"border-top-width")),s-=h.left+parseInt(m(n,"border-left-width")),r=i+o.height,l=s+o.width;break}while(n=n.parentNode)}return{top:i,left:s,bottom:r,right:l,width:u,height:c}}function Q(t,e,n,o){if(t){n=n||document;do{if(e!=null&&(e[0]===">"?t.parentNode===n&&nt(t,e):nt(t,e))||o&&t===n)return t;if(t===n)break}while(t=t.parentNode);return null}}function at(t,e){if(!t||!e)return!1;if(e.compareDocumentPosition)return!!(e.compareDocumentPosition(t)&16);if(e.contains&&t.nodeType===1)return e.contains(t)&&e!==t;for(;t=t.parentNode;)if(t===e)return!0;return!1}function Mt(t,e){let n=t.lastElementChild;for(;n&&(n===b.ghost||m(n,"display")==="none"||e);)n=n.previousElementSibling;return n||null}function K(t,e){if(!t||!t.parentNode)return-1;let n=0;for(;t=t.previousElementSibling;)t!==b.ghost&&t.nodeName.toUpperCase()!=="TEMPLATE"&&m(t,"display")!=="none"&&(!e||nt(t,e))&&n++;return n}function ct(t,e,n,o){let i=0,s=0,r=t.children;for(;i<r.length;){if(r[i]!==b.ghost&&m(r[i],"display")!=="none"&&Q(r[i],n,t,!1)&&r[i]!==b.dragged){if(s===e)return r[i];s++}i++}return null}function Rt(t,e){let n=m(t),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),i=ct(t,0,e),s=ct(t,1,e),r=i&&m(i),l=s&&m(s),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+D(i).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+D(s).width,h=Dt||tt?"cssFloat":"float";if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&r.float&&r.float!=="none"){let a=r.float==="left"?"left":"right";return s&&(l.clear==="both"||l.clear===a)?"vertical":"horizontal"}return i&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[h]==="none"||s&&n[h]==="none"&&c+u>o)?"vertical":"horizontal"}function V(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{const o=(" "+t.className+" ").replace(It," ").replace(" "+e+" "," ");t.className=(o+(n?" "+e:"")).replace(It," ")}}function nt(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function m(t,e,n){let o=t&&t.style;if(o){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),e===void 0?n:n[e];!(e in o)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),o[e]=n+(typeof n=="string"?"":"px")}}function te(t,e){let n="";if(typeof t=="string")n=t;else do{let i=m(t,"transform");i&&i!=="none"&&(n=i+" "+n)}while(!1);const o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(n)}function Ot(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function ee(t){return t.offsetWidth}function ne(t,e){return t.compareDocumentPosition?t.compareDocumentPosition(e):t.contains?(t!=e&&t.contains(e)&&16)+(t!=e&&e.contains(t)&&8)+(t.sourceIndex>=0&&e.sourceIndex>=0?(t.sourceIndex<e.sourceIndex&&4)+(t.sourceIndex>e.sourceIndex&&2):1):0}function ut(t,e){const n=ne(t,e);return n===2?1:n===4?-1:0}function ot(t){t.preventDefault!==void 0&&t.cancelable&&t.preventDefault()}function M({sortable:t,name:e,evt:n}){const o=t.options[e];if(typeof o=="function")return o(Object.assign({},n))}function it(t,...e){return typeof t=="function"?t(...e):t}const H="Sortable"+Date.now();function Ht(t){this.options=t,this.scrollEl=null,this.autoScrollInterval=null}Ht.prototype={nulling(){this.autoScrollInterval&&(clearInterval(this.autoScrollInterval),this.autoScrollInterval=null)},onStarted(){this.nulling(),this.autoScrollInterval=setInterval(this.autoScroll.bind(this))},onMove(t,e,n,o){const i=n?n[H].options:o;if(n&&!i.autoScroll){this.scrollEl=null;return}this.options=i,this.scrollEl=Zt(t),this.moveEvent=e},autoScroll(){let t=this.options,e=this.moveEvent,n=this.scrollEl,o=t.scrollThreshold,i=t.scrollSpeed;if(!n||e.clientX===void 0||e.clientY===void 0)return;const s=D(n);if(!s)return;const{clientX:r,clientY:l}=e,{top:c,right:u,bottom:h,left:a,height:w,width:S}=s;if(l<c||r>u||l>h||r<a)return;const{scrollTop:v,scrollLeft:O,scrollHeight:ft,scrollWidth:pt}=n;n.scrollLeft+=this.getScrollOffset(r,a,u,o,i.x,O,pt,S),n.scrollTop+=this.getScrollOffset(l,c,h,o,i.y,v,ft,w)},getScrollOffset(t,e,n,o,i,s,r,l){return s>0&&t>=e&&t<=e+o?Math.max(-1,(t-e)/o-1)*i:s+l<r&&t<=n&&t>=n-o?Math.min(1,(t-n)/o+1)*i:0}};function Nt(t){this.options=t,this.animationStack=[],this.animationCallbackId=null}Nt.prototype={collect(t){if(!t)return;let e=D(t),n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=Math.min(e.right,n),s=Math.min(e.bottom,o),r=Array.prototype.slice.call(t.children),l=[];for(let c=0,u=r.length;c<u;c++){const h=r[c];if(h===b.ghost||m(h,"display")==="none")continue;const a=D(h);if(!(a.bottom<0||a.right<0)){if(l.length===0&&h.previousElementSibling){let w=h.previousElementSibling;do if(w&&w!==b.ghost&&m(w,"display")!=="none")break;while(w=w.previousElementSibling);w&&l.push({el:w,rect:D(w)})}if(a.top-a.height>s||a.left-a.width>i){l.push({el:h,rect:a});break}l.push({el:h,rect:a})}}this.animationStack.push(l)},animate(t){let e=this.animationStack.pop(),n=this.options.animation;if(!e||!n){clearTimeout(this.animationCallbackId),typeof t=="function"&&t();return}let o=0;e.forEach(i=>{let s=0,r=i.el,l=D(r),c=i.rect,u=r.prevToRect,h=r.prevFromRect;if(r.animating&&h&&u&&Ot(c,l)){const a=te(r);if(a){const w={top:l.top-a.f,left:l.left-a.e},S=Pt(w,l),v=Pt(h,u);s=S/v*n}}Ot(c,l)||(r.prevFromRect=c,r.prevToRect=l,s||(s=n),this.execute(r,c,l,s)),s&&(o=Math.max(o,s))}),clearTimeout(this.animationCallbackId),o?this.animationCallbackId=setTimeout(()=>{typeof t=="function"&&t()},o):typeof t=="function"&&t()},execute(t,e,n,o){let i=this.options.easing||"",s=e.left-n.left,r=e.top-n.top;m(t,"transition",""),m(t,"transform",`translate3d(${s}px, ${r}px, 0)`),this.repaintDummy=ee(t),m(t,"transition",`transform ${o}ms ${i}`),m(t,"transform","translate3d(0px, 0px, 0px)"),typeof t.animating=="number"&&clearTimeout(t.animating),t.animating=setTimeout(()=>{m(t,"transition",""),m(t,"transform",""),t.prevFromRect=null,t.prevToRect=null,t.animating=null},o)}};function Pt(t,e){return Math.sqrt(Math.pow(t.left-e.left,2)+Math.pow(t.top-e.top,2))}let rt=[],$,_,p,g,G,C,f,E,A,x,U,z,Z,j,R,L,F,N,k,X,q;function Wt(t){let e={},n=t.group;(!n||typeof n!="object")&&(n={name:n,pull:!0,put:!0,revertDrag:!0}),e.name=n.name,e.pull=n.pull??!0,e.put=n.put??!0,e.revertDrag=n.revertDrag??!0,t.group=e}function oe(t,e){let n;return rt.reduce((o,i)=>{const s=i[H].options.emptyInsertThreshold;if(s==null)return;const r=D(i),l=t>=r.left-s&&t<=r.right+s,c=e>=r.top-s&&e<=r.bottom+s;return l&&c&&(!n||n&&r.left>=n.left&&r.right<=n.right&&r.top>=n.top&&r.bottom<=n.bottom)&&(o=i,n=r),o},null)}function ie(t){const e=L||R;return!(t.clientX!==void 0&&t.clientY!==void 0&&Math.abs(t.clientX-e.clientX)<=0&&Math.abs(t.clientY-e.clientY)<=0)}function b(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw`Sortable-dnd: \`el\` must be an HTMLElement, not ${{}.toString.call(t)}`;t[H]=this,this.el=t,this.options=e=Object.assign({},e);const n={store:null,group:"",handle:null,draggable:">*",sortable:!0,disabled:!1,customGhost:null,lockAxis:"",direction:"",animation:150,easing:"",ghostClass:"",ghostStyle:{},chosenClass:"",placeholderClass:"",autoScroll:!0,scrollThreshold:55,scrollSpeed:{x:10,y:10},delay:0,delayOnTouchOnly:!1,swapOnDrop:!0,removeCloneOnDrop:!0,dropOnAnimationEnd:!1,appendToBody:!1,supportTouch:"ontouchstart"in window,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,emptyInsertThreshold:-1};for(let o in n)!(o in e)&&(e[o]=n[o]);Wt(e);for(let o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));T(t,e.supportTouch?"touchstart":"mousedown",this._onDrag),this.autoScroller=new Ht(e),this.animator=new Nt(e),rt.push(t)}b.prototype={constructor:b,_onDrag(t){let e=this.el,n=this.options,o=n.handle,i=t.touches&&t.touches[0],s=(i||t).target,r=e.ownerDocument;if(p||n.disabled||!n.group.pull||/mousedown|pointerdown/.test(t.type)&&t.button!==0||lt&&s&&s.tagName.toUpperCase()==="SELECT")return;const l=Q(s,n.draggable,e);!l||l.animating||(R={event:t,clientX:(i||t).clientX,clientY:(i||t).clientY},p=l,N=i?p:document,T(N,"mouseup",this._onDrop),T(N,"touchend",this._onDrop),T(N,"touchcancel",this._onDrop),!(typeof o=="function"&&!o(t)||typeof o=="string"&&!Q(s,o,p))&&(n.delay&&(!n.delayOnTouchOnly||i)&&!(Dt||tt)?(T(r,"touchmove",this._delayedMoveHandler),T(r,"mousemove",this._delayedMoveHandler),T(r,"mouseup",this._cancelStart),T(r,"touchend",this._cancelStart),T(r,"touchcancel",this._cancelStart),this._dragStartTimer=setTimeout(()=>this._onStart(i,t),n.delay)):this._onStart(i,t)))},_delayedMoveHandler(t){const e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-R.clientX),Math.abs(e.clientY-R.clientY))>=Math.floor(this.options.touchStartThreshold/(window.devicePixelRatio||1))&&this._cancelStart()},_cancelStart(){let t=this.el.ownerDocument;clearTimeout(this._dragStartTimer),I(t,"touchmove",this._delayedMoveHandler),I(t,"mousemove",this._delayedMoveHandler),I(t,"mouseup",this._cancelStart),I(t,"touchend",this._cancelStart),I(t,"touchcancel",this._cancelStart)},_onStart(t,e){ot(e);let n=this.el,o=this.options,i=K(p);z=i,Z=i,j=i,$=n,_=n,C=n,A=p,x=p.parentNode,U=o.group.pull,X=p,k={to:n,target:p,newIndex:i,relative:0},f=p.cloneNode(!0),b.dragged=p,b.clone=f,b.active=this,M({sortable:this,name:"onChoose",evt:this._getEventProperties(e)}),V(p,o.chosenClass,!0),T(N,t?"touchmove":"mousemove",this._nearestSortable);try{document.selection?setTimeout(()=>document.selection.empty(),0):window.getSelection().removeAllRanges()}catch{}T(document,"selectstart",ot),lt&&m(document.body,"user-select","none")},_onStarted(){let t=this.options;this.animator.collect(x),this._appendGhost(),V(f,t.chosenClass,!0),V(f,t.placeholderClass,!0),p.parentNode.insertBefore(f,p),m(p,"display","none"),M({sortable:this,name:"onDrag",evt:this._getEventProperties(R.event)}),this.animator.animate(),this.autoScroller.onStarted()},_appendGhost(){if(E)return;let t=this.options;const e=t.appendToBody?document.body:this.el;E=(it(t.customGhost,f)||f).cloneNode(!0),V(E,t.ghostClass,!0);const o=D(p),i=Object.assign({position:"fixed",top:o.top,left:o.left,width:o.width,height:o.height,margin:0,zIndex:1e5,opacity:"0.8",overflow:"hidden",boxSizing:"border-box",transform:"",transition:"",pointerEvents:"none"},t.ghostStyle);for(let l in i)m(E,l,i[l]);b.ghost=E,e.appendChild(E);const s=(R.clientX-o.left)/parseInt(E.style.width)*100,r=(R.clientY-o.top)/parseInt(E.style.height)*100;m(E,"transform-origin",`${s}% ${r}%`),m(E,"will-change","transform")},_nearestSortable(t){ot(t);let e=t.touches&&t.touches[0],n=e||t;if(!p||!ie(n))return;!L&&this._onStarted();let o=this.options.lockAxis,i=o==="x"?R.clientX:n.clientX,s=o==="y"?R.clientY:n.clientY,r=document.elementFromPoint(i,s),l=i-R.clientX,c=s-R.clientY;L={event:t,clientX:i,clientY:s},m(E,"transform",`translate3d(${l}px, ${c}px, 0)`);const u=oe(i,s);u&&u[H]._onMove(t,r),this.autoScroller.onMove(r,L,u,this.options)},_allowPut(){let t=this.options.group,e=C[H].options.group;return this.el===C?!0:t.put?t.put.join&&t.put.indexOf(e.name)>-1||e.name&&t.name&&e.name===t.name:!1},_getDirection(){let t=this.options.draggable,e=this.options.direction;return e?it(e,L.event,f,this):Rt(x,t)},_allowSwap(){let t=D(g),e=this._getDirection()==="vertical",n=e?"top":"left",o=e?"bottom":"right",i=g[e?"offsetHeight":"offsetWidth"],s=e?L.clientY:L.clientX,r=s>=t[n]&&s<t[o]-i/2?-1:1,l=ct(x,0,this.options.draggable),c=Mt(x),u=D(l),h=D(c);if(g===x||at(x,g))return f===l&&s<u[n]?(G=g,!0):f===c&&s>h[o]?(G=g.nextSibling,!0):!1;const a=ut(f,g);return G=a<0?g.nextSibling:g,F!==g?(q=r,!0):q!==r?(q=r,r<0?a>0:a<0):!1},_onMove(t,e){let n=this.el,o=this.options;if(!(o.disabled||!this._allowPut())){if(g=Q(e,o.draggable,n),M({sortable:this,name:"onMove",evt:this._getEventProperties(t,{target:g})}),!o.sortable&&n===C){_!==C&&(g=F=p,q=0,this._onInsert(t));return}if(n!==_&&(e===n||!Mt(n))){g=F=null,this._onInsert(t);return}if(!(!g||g.animating||at(g,f)||!this._allowSwap())){if(g===f||G===f){F=g;return}n!==_?this._onInsert(t):g!==p&&this._onChange(t),F=g}}},_onInsert(t){let e=this.el,n=g||f,o=U==="clone"&&e!==C&&_===C,i=U==="clone"&&e===C&&_!==C,s=at(g,document),r=g===p&&!s,l=_[H],c=C[H];$=e,z=K(f),A=n,x=s?g.parentNode:e,l.animator.collect(f.parentNode),this.animator.collect(x),o&&(k.target=X,k.newIndex=z,k.relative=X===p?0:ut(f,X),m(p,"display",""),c.options.group.revertDrag||f.parentNode.insertBefore(p,f)),i&&(z=K(p),m(p,"display","none")),m(f,"display",r?"none":""),g&&s?x.insertBefore(f,q<0?g:g.nextSibling):x.appendChild(f),Z=r?j:K(f),o&&c.options.group.revertDrag&&(k.target=p,k.newIndex=j,k.relative=0,M({sortable:c,name:"onChange",evt:this._getEventProperties(t,{to:C,target:p,newIndex:j,revertDrag:!0})})),o||M({sortable:l,name:"onRemove",evt:this._getEventProperties(t,{newIndex:-1})}),i&&n!==p&&(X=n,M({sortable:this,name:"onChange",evt:this._getEventProperties(t,{from:C,backToOrigin:!0})})),i||M({sortable:this,name:"onAdd",evt:this._getEventProperties(t,{oldIndex:-1})}),l.animator.animate(),this.animator.animate(),_=e},_onChange(t){let e=this.el;this.animator.collect(x),z=K(f),x=g.parentNode,A=g,e===C&&(X=g),x.insertBefore(f,G),Z=K(f),M({sortable:this,name:"onChange",evt:this._getEventProperties(t)}),M({sortable:this,name:"onDragChange",evt:this._getEventProperties(t)}),this.animator.animate(),_=e},_onDrop(t){let e=this.options;if(this._cancelStart(),I(N,"touchmove",this._nearestSortable),I(N,"mousemove",this._nearestSortable),I(N,"mouseup",this._onDrop),I(N,"touchend",this._onDrop),I(N,"touchcancel",this._onDrop),I(document,"selectstart",ot),lt&&m(document.body,"user-select",""),E&&E.parentNode&&E.parentNode.removeChild(E),C)if(_=C,z=j,A===f&&(A=p),V(p,e.chosenClass,!1),M({sortable:this,name:"onUnchoose",evt:this._getEventProperties(t)}),L){this.animator.collect(x),V(f,e.chosenClass,!1),V(f,e.placeholderClass,!1);const n=this._getEventProperties(t);!e.dropOnAnimationEnd&&this._onEnd(n),this.animator.animate(()=>{e.dropOnAnimationEnd&&this._onEnd(n)})}else this._nulling();else this._nulling()},_onEnd(t){let e=this.options,n=U==="clone",o=_===$;(!n||o)&&it(e.swapOnDrop,t)&&x.insertBefore(p,f),(!n||o)&&it(e.removeCloneOnDrop,t)&&f&&f.parentNode&&f.parentNode.removeChild(f),m(p,"display",""),_!==$&&M({sortable:_[H],name:"onDrop",evt:Object.assign({},t,n?k:{newIndex:-1})}),M({sortable:$[H],name:"onDrop",evt:Object.assign({},t,o?{}:{oldIndex:-1})}),this._nulling()},_getEventProperties(t,e={}){let n={};return n.event=t,n.to=$,n.from=_,n.node=p,n.clone=f,n.target=A,n.oldIndex=z,n.newIndex=Z,n.pullMode=U,Object.assign(n,e),n.relative=A===p?0:ut(f,A),n},_nulling(){$=_=p=g=G=C=f=E=A=x=U=z=Z=j=R=L=F=N=k=X=q=b.clone=b.ghost=b.active=b.dragged=null,this.autoScroller.nulling()},destroy(){this._cancelStart(),this._nulling(),I(this.el,"touchstart",this._onDrag),I(this.el,"mousedown",this._onDrag);const t=rt.indexOf(this.el);t>-1&&rt.splice(t,1),this.el[H]=this.animator=this.autoScroller=null},option(t,e){if(e===void 0)return this.options[t];this.options[t]=e,this.animator.options[t]=e,this.autoScroller.options[t]=e,t==="group"&&Wt(this.options)}},b.utils={on:T,off:I,css:m,index:K,matches:nt,closest:Q,getRect:D,toggleClass:V,detectDirection:Rt},b.get=function(t){return t[H]},b.create=function(t,e){return new b(t,e)};function st(t,e){return t===0?t===e:t==e}const dt=["delay","group","handle","lockAxis","disabled","sortable","draggable","animation","autoScroll","ghostClass","ghostStyle","chosenClass","scrollSpeed","fallbackOnBody","scrollThreshold","delayOnTouchOnly","placeholderClass"];class re{constructor(e,n){this.el=e,this.options=n,this.rangeChanged=!1,this.installSortable()}destroy(){this.sortable.destroy(),this.rangeChanged=!1}option(e,n){this.options[e]=n,dt.includes(e)&&this.sortable.option(e,n)}installSortable(){const e=dt.reduce((n,o)=>(n[o]=this.options[o],n),{});this.sortable=new b(this.el,{...e,emptyInsertThreshold:0,swapOnDrop:n=>n.from===n.to,removeCloneOnDrop:n=>n.from===n.to,onDrag:n=>this.onDrag(n),onDrop:n=>this.onDrop(n),onDragChange:n=>this.onDragChange(n),onChoose:n=>this.onChoose(n),onUnchoose:n=>this.onUnchoose(n)})}onChoose(e){this.dispatchEvent("onChoose",e)}onUnchoose(e){this.dispatchEvent("onUnchoose",e)}onDrag(e){const n=e.node.getAttribute("data-key"),o=this.getIndex(n),i=this.options.list[o],s=this.options.uniqueKeys[o];this.sortable.option("store",{item:i,key:s,index:o,oldIndex:o}),this.dispatchEvent("onDrag",{item:i,key:s,index:o,event:e})}onDragChange(e){const n=b.get(e.from)?.option("store"),o=n?n.oldIndex:-1,i=n?n.key:null,s=e.target.getAttribute("data-key");let r=this.getIndex(s);const l=this.getIndex(i);if((l<r&&e.relative===-1||l>r&&e.relative===1)&&(r+=e.relative),o===r)return;const c={key:s,oldIndex:o,newIndex:r,event:e,item:this.options.list[r]};this.sortable.option("store").oldIndex=r,this.dispatchEvent("onDragChange",c)}onDrop(e){const{item:n,key:o,index:i}=b.get(e.from)?.option("store"),s=this.options.list,r={key:o,item:n,list:s,event:e,changed:!1,oldList:[...s],oldIndex:i,newIndex:i};e.from===e.to&&e.node===e.target||this.handleDropEvent(e,r,i),this.dispatchEvent("onDrop",r),e.from===this.el&&this.rangeChanged&&b.dragged?.remove(),e.from!==e.to&&b.clone?.remove(),this.rangeChanged=!1}handleDropEvent(e,n,o){const i=e.target.getAttribute("data-key");let s=-1,r=o;e.from===e.to?(r=this.getIndex(n.key),s=this.getIndex(i),(r<s&&e.relative===-1||r>s&&e.relative===1)&&(s+=e.relative),s!==r&&(n.list.splice(r,1),n.list.splice(s,0,n.item))):(e.from===this.el&&(r=this.getIndex(n.key),n.list.splice(r,1)),e.to===this.el&&(r=-1,s=this.getIndex(i),e.relative===0?s=n.list.length:e.relative===1&&(s+=e.relative),n.list.splice(s,0,n.item))),n.changed=e.from!==e.to||s!==r,n.oldIndex=r,n.newIndex=s}getIndex(e){if(e==null)return-1;const{uniqueKeys:n}=this.options;for(let o=0,i=n.length;o<i;o++)if(st(n[o],e))return o;return-1}dispatchEvent(e,n){const o=this.options[e];o&&o(n)}}const se=({mounted:t,updated:e,unmounted:n})=>d.defineComponent({props:["vnode"],mounted(){t(this.$el)},onUpdated(){e(this.$el)},onUnmounted(){n(this.$el)},render(o){return o.vnode}}),le=d.defineComponent({props:Bt,emits:["resize"],setup(t,{emit:e,slots:n}){let o=null;const i=u=>{const h=u?u[t.sizeKey]:0;e("resize",h,t.dataKey)},c=se({mounted:u=>{typeof ResizeObserver<"u"&&(o=new ResizeObserver(()=>{i(u)}),u&&o.observe(u))},updated:u=>{i(u)},unmounted:()=>{o&&(o.disconnect(),o=null)}});return()=>{const{dataKey:u}=t,[h]=n.default?.()||[];return d.h(c,{key:u,role:"item",vnode:h,"data-key":u},{default:()=>n.default?.()})}}}),ae=t=>d.isRef(t)?t.value:t;function ht(t,e){return(Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce((n,o)=>(n||{})[o],t)}const At=d.defineComponent({props:kt,setup(t,{emit:e,slots:n,expose:o}){const i=d.ref([]),s=d.ref(!1),r=d.ref(null);let l=[],c;const u=d.ref(""),{list:h,containerProps:a,wrapperProps:w,scrollTo:S}=Ft(i,{itemHeight:t.getItemHeight,overscan:30}),v=()=>{l=i.value.map(y=>ht(y,t.dataKey)),c?.option("uniqueKeys",l)};function O(){const y=ae(t.modelValue);y&&(i.value=y,v(),c?.option("list",y))}d.watch(()=>[t.modelValue],()=>{O()},{deep:!0});const ft=y=>{s.value=!0,t.sortable||c.option("autoScroll",!1),e("drag",y)},pt=y=>{s.value=!1,c.option("autoScroll",t.autoScroll),y.changed&&e("update:modelValue",y.list),e("drop",y)},ce=y=>{e("dragChange",y)},ue=y=>{u.value=y.node.getAttribute("data-key")},de=()=>{u.value=""};function he(y,P){st(P,u.value)}const Lt=d.computed(()=>dt.reduce((y,P)=>(y[P]=t[P],y),{}));d.watch(Lt,(y,P)=>{if(c)for(let W in y)y[W]!==P[W]&&c.option(W,y[W])});function fe(){c=new re(a.ref.value,{...Lt.value,list:i.value,uniqueKeys:l,onDrag:ft,onDrop:pt,onChoose:ue,onUnchoose:de,onDragChange:ce})}function gt(y){S&&S(y)}function pe(y){const P=i.value.findIndex(W=>st(ht(W,t.dataKey),y));P!==-1&&S&&S(P)}function ge(){gt(i.value.length-1)}function me(){gt(0)}function ye(){return{width:a.ref.value?.clientWidth||0,height:a.ref.value?.clientHeight||0}}function we(){return{width:r.value?.offsetWidth||0,height:r.value?.offsetHeight||0}}return d.onBeforeMount(()=>{O()}),d.onMounted(()=>{fe()}),o({getClientSize:ye,getWrapperSize:we,scrollToKey:pe,scrollToBottom:ge,scrollToTop:me,scrollToIndex:gt}),()=>d.createVNode("div",d.mergeProps(a,{style:{position:"absolute",width:"100%",height:"100%"}}),[d.createVNode("div",d.mergeProps({ref:r},w.value),[h.value.map((y,P)=>{const W=ht(y.data,t.dataKey),be=s.value&&st(W,u.value);return d.createVNode(le,{key:W,dataKey:W,style:{display:be?"none":"flex"},sizeKey:"offsetHeight",onResize:he},{default:()=>n.item?.({item:y.data,index:P})})})])])}});B.VirtualSortable=At,B.default=At,Object.defineProperties(B,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
